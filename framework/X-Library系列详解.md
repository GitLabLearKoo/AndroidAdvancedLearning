# X-Library系列详解

> 自2017年初开始，我就致力于Android应用框架的研究，到2018年开始在Github上陆续开源系列作品，再到2019年收获我的第一个star过千的项目，期间我付出了很多，失去了很多，同时也获得了很多。

## 前言

为了能够让更多的人了解到我的开源项目，我也是使出了浑身解数，写了不少文章和文档来提高项目的曝光率，不过在这期间我也发现了不少问题：读者的水平参差不齐，以往我写的文章都是建立在有一定开发基础之上的，这就导致了很多新手小白、学生党看不懂，不会用，瞎折腾，这完全违背了我的初衷。我希望我的开源项目不仅能够服务那些有一定开发经验的人，还能帮助那些热爱Android的人学习并提升自己的开发水平，早日能够跟上我们的步伐。

在接下来的数月里，我将一一详细讲解我开源的几个热门项目，介绍他们所使用的场景，解决的问题以及分析其中实现的逻辑。

## 概述

> 所有的技术框架都必须服务于实际生产，否则就是耍流氓。

我一直认为这世上没有绝对完美的事物，当然技术也并不例外。在做Android的最初几年里，我一直认为技术是产品的灵魂，用于创造产品而又高于产品，是无可替代的，这也是我初期为何执着于技术的原因。渐渐地，当一项技术趋于成熟的时候，你会发现其实技术也并不是想象中的那么重要，同样的功能或是产品，你可以用2种或者更多的技术方案来实现，这个时候你才会发现，原来技术也如同资本、人力、市场和物料等资源，只是我们实现目的的工具而已。

其实`X-Library`正是我早期做Android开发过程中积累沉淀下来的技术经验，并通过我后期不断完善之后形成的。虽说可能不及大厂和google爸爸他们开源的项目那么牛掰，不过相信我，这些框架都是在实际生产中诞生出来的优秀项目，相比大厂和google爸爸他们开源的项目，他们可能更适合中小企业或者独立开发者的你使用哦！

下面是`X-Library`的思维导图：

![](../img/x_library.png)

## 基础组件

### XPage

> 一个非常方便的fragment页面框架

XPage是我开源的第一个项目，也是最实用、最方便的项目之一。设计的初衷是希望能做一个通用的Activity作为壳，Fragment作为页面填充展示，并且能够实现自由的切换和数据交互。

#### 设计原由

当初做Android开发时每当我写一个页面，都需要创建一个Activity，并且还需要在manifest中注册一堆Activity信息，这样既不方便，而且对资源的开销也比较大。因此当时我就设想能否创造出一个通用万能的Activity容器，可以全权负责Fragment的切换展示和数据交互，只需要一行代码即可完成所有的操作，还不需要自己手动去注册，可以一键生成。

#### 设计思路

刚开始的时候真的很难，没有什么好的思路，最初只是简单封装了一个Activity，通过传入一些key值从而获取并加载对应的fragment，类似`ARouter`中Fragment发现那种。其实这样做并没有解决一个容器的问题，而且页面切换也不是很灵活，不够通用，使用起来也不是很方便。

突然有一天我发现Github上有个开源项目[CorePage](https://github.com/lizhangqu/CorePage/)写得非常好，完美地解决了我对一个Activity容器的问题，于是我决定仔细研究其代码，并在其基础上设计出了XPage的最初版本。

就在XPage正式投入使用的过程中，我发现还是存在不少问题的：

* 1.对外API不够灵活，使用起来不够方便；

* 2.每个Fragment仍需要手动注册，很麻烦；

对于API不够灵活的问题，我在之后的版本中陆续通过构造者模式设计以及Android主题属性等手段解决了。

而对于手动注册的问题，我正是借鉴了ARouter的思路，通过Android APT技术，从而实现了Fragment信息的自动注册。

#### 解决痛点

* 只需要一个Activity容器就可以实现多个页面的交互。

* Fragment自由切换和数据交互。

* 无需在manifest中注册一堆Activity信息，通过@Page注解一键自动注册。

#### 项目地址

https://github.com/xuexiangjys/XPage

---

### XAOP

> 一个轻量级的AOP(Android)应用框架。囊括了最实用的AOP应用。

XAOP是我刚接触到AOP(面向切片编程)思想后，灵光乍现编写的应用库，应该说是我使用得最多的库了，因为有了它，编码真的很方便！

#### 设计原由

在我们平时开发的过程中，一定会遇到权限申请、线程切换、数据缓存、异常捕获、埋点和方法执行时间统计等问题。这些都是非常常见的问题，实现起来也不是很难，不过就是太麻烦了，还会让程序多出很多重复性、模版化的代码。

#### 设计思路

让我最初接触到AOP思想的是JakeWharton的[hugo](https://github.com/JakeWharton/hugo),通过阅读它的源码之后，让我对`aspectj`这项技术的动态代码编织深深地着了迷。之后我详细研究了`aspectj`相关的技术，并不断搜集AOP在Android上的典型应用场景，然后通过`aspectj`这项技术去逐一实现。最后就成就了XAOP这个库。

#### 解决痛点

* 可以解决快速点击的问题
* 解决Android6.0以上动态权限申请的问题
* 线程自由切换的问题
* 日志埋点问题
* 缓存问题（磁盘缓存和内存缓存）
* 异常捕获处理
* 业务拦截（登陆验证、有效性验证等）

#### 项目地址

https://github.com/xuexiangjys/XAOP

---

### XUI

> 一个简洁而又优雅的Android原生UI框架，解放你的双手！

XUI可以说是我花费心血最多的开源项目了，目前稍微大一点的项目我都会选择引入它。XUI几乎涵盖了目前Android开发所需要的所有组件，可以说有了XUI之后，可以大大提高我们的开发效率，让我们可以将精力很多地放在业务功能和数据处理上。可以说XUI是目前Github上组件最全、文档最详细、案例最多的Android原生UI库。

#### 设计原由

相信做过Android的人都知道Android原生组件在国内很不受设计师的待见，至于Google推行的Material Design设计风格更是无人问津，这就导致了设计师给出的原型图几乎是清一色的IOS风格，更尴尬的是，网上Android相关的开源UI库是少之又少，这可就为难死我们了，几乎所有的基础组件都需要自己重写。之前也写过React和Vue，发现它们都有非常方便的UI库，而且使用起来也非常方便，直接在示例代码的基础上修修改改就能大致上实现自己想要的效果，极大地提高了开发的效率。

#### 设计思路

在开始着手做这样一个开源库之前，我是一点思路都没有的。好在在2017年的某一天，我接触到了[QMUI](https://github.com/Tencent/QMUI_Android),通过阅读它的源码，我发现它的设计思路非常好，可以通过设置不同的主题样式、组件属性等实现不同的组件效果，非常灵活；除此之外，它还对UI主题风格做了较为详细的制定和归类，可以说很有启发意义。于是我就遵循了QMUI的思路，开启了XUI的编写。

#### 解决痛点

* 简洁优雅，尽可能少得引用资源文件的数量，项目库整体大小不足1M。
* 组件丰富，提供了绝大多数我们在开发者常用的功能组件。
* 使用简单，为方便快速开发，提高开发效率，对api进行了优化，提供一键式接入。
* 样式统一，框架提供了一系列统一的样式，使UI整体看上去美观和谐。
* 兼容性高，框架还提供了3种不同尺寸设备的样式（4.5英寸、7英寸和10英寸），并且最低兼容到Android 17, 让UI兼容性更强。
* 扩展性强，各组件提供了丰富的属性和样式API，可以通过设置不同的样式属性，构建不同风格的UI。

#### 项目地址

https://github.com/xuexiangjys/XUI

---

### XUpdate

> 一个轻量级、高可用性的Android全量版本更新框架。

XUpdate是为了解决在不同项目组、不同平台之间进行统一的Android全量版本更新的库。它具有轻量、灵活、低耦合、高可用等特点，可以很方便地定制属于自己的版本更新。

#### 设计原由

在没有XUpdate之前的版本更新，Android版本更新基本都是靠写各种版本更新工具类来实现版本更新，更可怕的是有时在不同项目组或者平台之间，它们的版本更新完全是不一样的，这样的结果就是会写无数的版本更新工具类，并且每次更换一个项目组或者平台就需要从头重写再写一遍，非常得麻烦。当时我就在想，版本更新作为一个Android应用基本都有，且内容相对稳定的功能，有没有可能设计出一个通用的、不为业务或者平台所影响的基础库呢？

#### 设计思路

在着手写XUpdate之前，我特地去Github上搜了一圈有关Android版本更新的内容，发现[AppUpdate](https://github.com/WVector/AppUpdate)这个项目star数量最多。但是当我翻阅它的源码之后发现，它设计得并不优美，内部耦合非常严重，不过优点就是Android版本更新的功能基本都涵盖了。于是我就照着它所拥有的功能，结合了我对版本更新的理解进行了重新设计，感兴趣的可[点击查看框架UML设计图](https://github.com/xuexiangjys/XUpdate/blob/master/img/xupdate_uml.png)。

#### 解决痛点

* 使用简单，只需一行代码即可完成版本更新功能。
* 功能强大，兼容Android6.0、7.0、8.0，支持静默更新和自动更新，支持国际化。
* 扩展性强，可自定义请求API接口、提示弹窗、下载服务、文件加密器等。
* 搭建简单，只需提供json内容即可支持版本更新。
* 配套齐全，默认提供了后台服务和管理界面。

#### 项目地址

* Android基础库: https://github.com/xuexiangjys/XUpdate
* 版本更新后台服务: https://github.com/xuexiangjys/XUpdateService
* 版本更新管理系统: https://github.com/xuexiangjys/xupdate-management

---

### XHttp2

> 一个功能强悍的网络请求库，使用RxJava2 + Retrofit2 + OKHttp组合进行封装。

XHttp2的出现主要是为了解决网络请求前后端统一、灵活性、易用性和可拓展性等问题。它提供了丰富的API调用和功能，可以灵活地设置请求参数、拦截器、缓存策略，动态添加参数、异常拦截捕获、自定义请求等。

#### 设计原由

在没有设计XHttp2之前，网络请求我用过async-http、Volley、okhttp、retrofit等网络请求，普遍的做法就是

---

### XPush

> 一个轻量级、可插拔的Android消息推送框架。一键集成推送（极光推送、友盟推送、信鸽推送、华为、小米推送等），提供有效的保活机制，支持推送的拓展，充分解耦推送和业务逻辑，解放你的双手！

---

### XQRCode

> 一个非常方便实用的二维码扫描、解析、生成库

---

### XLog

> 一个简易的日志打印框架（支持打印策略自定义，默认提供2种策略：logcat打印和磁盘打印）


---

### XRouter

> 一个轻量级的Android路由框架，基于ARouter上进行改良，优化Fragment的使用，可结合XPage使用。

XRouter是我在仔细研读ARouter框架的源码之后，结合我使用XPage过程中遇到的问题，而进行重新改写的一个框架，一般是配合XPage使用。

#### 设计原由

在我使用ARouter的时候，我发现它对Fragment的支持并不是很友好。说到底它主要还是为Activity路由服务的。而在我的XPage中Activity类非常少，因此使用起来极为不方便，不过ARouter的依赖注入设计得还是挺好的，因此改进它对Fragment的支持就显得尤为重要。

#### 解决痛点

* 让ARouter对Fragment的支持更加友好。
* 配合XPage使用。

---

### XOrmlite

> 一个方便实用的OrmLite数据库框架，支持一键集成。

XOrmlite是我在接触了APT（编译时注解处理）技术后，在数据库框架构建上的一项应用。通过它，你可以一键集成ormlite数据库框架，非常得方便。

#### 设计原由

做Android都必定会和SQLite打交道，无奈在Google还没有提供Room数据库框架的时候，真的是要被SQLite折腾废了，好在后来有了ormlite数据库框架。

在使用了ormlite一段时间后，我发现应用使用的数据库不一定都是内存数据库，可能还需要读取操作外部存储的数据库，于是我又对其做了一定的封装，让其同时支持内部数据库和外部存储数据库，同时增加了数据库连接池的功能。

但就是这样，在使用的过程中我仍然发现库在项目间的移植非常麻烦,每次引入都需要创建几个几乎完全类似的类，而应对的通常做法就是复制粘贴，有时有的地方不修改就可能导致出错，总之还是比较麻烦的。同时，在数据库第一次打开的时候，我们还需要根据数据库类去创建对应的数据库表，有的时候漏了个没发现，结果就有可能出现排查了一下午问题最后发现是漏写了一个类的尴尬。因此需要使用APT技术，在程序编译时自动帮我们生成那几个我们每次都需要创建的类以及收集我们所有使用到的数据库实体类信息，这样就可以大大减少错误的发生，降低了库的引入难度。

#### 设计思路

XOrmlite的设计思路很简单，就是基于享元模式做了一个数据库连接池，然后对Ormlite数据库进行了二次封装，然后通过APT技术分别生成数据库框架构建所需要的连接池和实现接口，并自动收集项目中所使用到的所有数据库实体信息类用于数据库表的初始创建。

#### 解决痛点

* 支持自动生成数据库管理仓库DataBaseRepository和自动搜索所有的数据库表类，并自动创建数据库表，简化了数据库框架的引入。
* 支持内部存储和外部存储两种数据库，支持自定义数据库存储位置。
* 提供了常用的数据库操作API，简化了数据库的使用。

#### 项目地址

https://github.com/xuexiangjys/XOrmlite

---

### XUtil

> 一个方便实用的Android工具类库

---

### RxUtil2

> 一个简易的悬浮窗实现方案


---

### XTCP

> 一个便捷的TCP消息包拼装和解析框架


---

### XIPC

> 一个Android通用的IPC(进程通信)框架。该项目主要是模仿饿了么开源项目Hermes的设计进行的自我理解改写。

---

### XFloatView

> 一个简易的悬浮窗实现方案

---

### XVideo